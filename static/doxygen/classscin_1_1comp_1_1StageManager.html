<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.17"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Scintillator: scin::comp::StageManager Class Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="icon.png"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Scintillator
   &#160;<span id="projectnumber">v0.0.1 at 1b5c195</span>
   </div>
   <div id="projectbrief">Documentation specific to the C++-based scinsynth</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.17 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><b>scin</b></li><li class="navelem"><b>comp</b></li><li class="navelem"><a class="el" href="classscin_1_1comp_1_1StageManager.html">StageManager</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#nested-classes">Classes</a> &#124;
<a href="#pub-methods">Public Member Functions</a> &#124;
<a href="#pri-methods">Private Member Functions</a> &#124;
<a href="#pri-attribs">Private Attributes</a> &#124;
<a href="classscin_1_1comp_1_1StageManager-members.html">List of all members</a>  </div>
  <div class="headertitle">
<div class="title">scin::comp::StageManager Class Reference</div>  </div>
</div><!--header-->
<div class="contents">

<p><code>#include &lt;StageManager.hpp&gt;</code></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="nested-classes"></a>
Classes</h2></td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structscin_1_1comp_1_1StageManager_1_1Wait.html">Wait</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pub-methods"></a>
Public Member Functions</h2></td></tr>
<tr class="memitem:a801e951a2ad85417f140947b6a42e396"><td class="memItemLeft" align="right" valign="top"><a id="a801e951a2ad85417f140947b6a42e396"></a>
&#160;</td><td class="memItemRight" valign="bottom"><b>StageManager</b> (std::shared_ptr&lt; <a class="el" href="classscin_1_1vk_1_1Device.html">vk::Device</a> &gt; device)</td></tr>
<tr class="separator:a801e951a2ad85417f140947b6a42e396"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a931e2ad515cc751a09bf3433a752ee6d"><td class="memItemLeft" align="right" valign="top"><a id="a931e2ad515cc751a09bf3433a752ee6d"></a>
bool&#160;</td><td class="memItemRight" valign="bottom"><b>create</b> (size_t numberOfImages)</td></tr>
<tr class="separator:a931e2ad515cc751a09bf3433a752ee6d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac4b26d91a5045bc9fa408e14b5320544"><td class="memItemLeft" align="right" valign="top"><a id="ac4b26d91a5045bc9fa408e14b5320544"></a>
void&#160;</td><td class="memItemRight" valign="bottom"><b>destroy</b> ()</td></tr>
<tr class="separator:ac4b26d91a5045bc9fa408e14b5320544"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad73aa252c9730e1d8f6ed591a07403cc"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classscin_1_1comp_1_1StageManager.html#ad73aa252c9730e1d8f6ed591a07403cc">setStagingRequested</a> (std::function&lt; void()&gt; requestFunction)</td></tr>
<tr class="separator:ad73aa252c9730e1d8f6ed591a07403cc"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a900f1f9de271ef4ff30b9071a81392b9"><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classscin_1_1comp_1_1StageManager.html#a900f1f9de271ef4ff30b9071a81392b9">stageImage</a> (std::shared_ptr&lt; <a class="el" href="classscin_1_1vk_1_1HostBuffer.html">vk::HostBuffer</a> &gt; hostBuffer, std::shared_ptr&lt; <a class="el" href="classscin_1_1vk_1_1DeviceImage.html">vk::DeviceImage</a> &gt; deviceImage, std::function&lt; void()&gt; completion)</td></tr>
<tr class="separator:a900f1f9de271ef4ff30b9071a81392b9"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa99922762802ea02b4ad818be05e01f3"><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classscin_1_1comp_1_1StageManager.html#aa99922762802ea02b4ad818be05e01f3">submitTransferCommands</a> (VkQueue queue)</td></tr>
<tr class="separator:aa99922762802ea02b4ad818be05e01f3"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pri-methods"></a>
Private Member Functions</h2></td></tr>
<tr class="memitem:a2cdbe7b17383bb47b9df40c8af300d2e"><td class="memItemLeft" align="right" valign="top"><a id="a2cdbe7b17383bb47b9df40c8af300d2e"></a>
void&#160;</td><td class="memItemRight" valign="bottom"><b>callbackThreadMain</b> ()</td></tr>
<tr class="separator:a2cdbe7b17383bb47b9df40c8af300d2e"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pri-attribs"></a>
Private Attributes</h2></td></tr>
<tr class="memitem:ab5453ebed0497d96c1fa82310b57625e"><td class="memItemLeft" align="right" valign="top"><a id="ab5453ebed0497d96c1fa82310b57625e"></a>
std::shared_ptr&lt; <a class="el" href="classscin_1_1vk_1_1Device.html">vk::Device</a> &gt;&#160;</td><td class="memItemRight" valign="bottom"><b>m_device</b></td></tr>
<tr class="separator:ab5453ebed0497d96c1fa82310b57625e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a7140b1dd993fa528aec26fdcb98e00ef"><td class="memItemLeft" align="right" valign="top"><a id="a7140b1dd993fa528aec26fdcb98e00ef"></a>
std::shared_ptr&lt; <a class="el" href="classscin_1_1vk_1_1CommandPool.html">vk::CommandPool</a> &gt;&#160;</td><td class="memItemRight" valign="bottom"><b>m_commandPool</b></td></tr>
<tr class="separator:a7140b1dd993fa528aec26fdcb98e00ef"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a82e8eaa24b605eebed1b329534b0556c"><td class="memItemLeft" align="right" valign="top"><a id="a82e8eaa24b605eebed1b329534b0556c"></a>
std::vector&lt; VkFence &gt;&#160;</td><td class="memItemRight" valign="bottom"><b>m_fences</b></td></tr>
<tr class="separator:a82e8eaa24b605eebed1b329534b0556c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a75baa76efe181650b18c1b99a94d26e8"><td class="memItemLeft" align="right" valign="top"><a id="a75baa76efe181650b18c1b99a94d26e8"></a>
std::function&lt; void()&gt;&#160;</td><td class="memItemRight" valign="bottom"><b>m_stagingRequested</b></td></tr>
<tr class="separator:a75baa76efe181650b18c1b99a94d26e8"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a089ba098b7fa2ffefecd8328b8734345"><td class="memItemLeft" align="right" valign="top"><a id="a089ba098b7fa2ffefecd8328b8734345"></a>
std::atomic&lt; bool &gt;&#160;</td><td class="memItemRight" valign="bottom"><b>m_hasCommands</b></td></tr>
<tr class="separator:a089ba098b7fa2ffefecd8328b8734345"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa99b43d59b5d46a1819ef6161dcbbbf6"><td class="memItemLeft" align="right" valign="top"><a id="aa99b43d59b5d46a1819ef6161dcbbbf6"></a>
std::mutex&#160;</td><td class="memItemRight" valign="bottom"><b>m_commandMutex</b></td></tr>
<tr class="separator:aa99b43d59b5d46a1819ef6161dcbbbf6"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa0f77a5fc90721ee7166ff3aaddbaa71"><td class="memItemLeft" align="right" valign="top"><a id="aa0f77a5fc90721ee7166ff3aaddbaa71"></a>
<a class="el" href="structscin_1_1comp_1_1StageManager_1_1Wait.html">Wait</a>&#160;</td><td class="memItemRight" valign="bottom"><b>m_pendingWait</b></td></tr>
<tr class="separator:aa0f77a5fc90721ee7166ff3aaddbaa71"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a1226b2297571ae02d258953f45bd0063"><td class="memItemLeft" align="right" valign="top"><a id="a1226b2297571ae02d258953f45bd0063"></a>
std::mutex&#160;</td><td class="memItemRight" valign="bottom"><b>m_waitMutex</b></td></tr>
<tr class="separator:a1226b2297571ae02d258953f45bd0063"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:affb0c199aa42b451aa5bde772189d5c4"><td class="memItemLeft" align="right" valign="top"><a id="affb0c199aa42b451aa5bde772189d5c4"></a>
std::condition_variable&#160;</td><td class="memItemRight" valign="bottom"><b>m_waitCondition</b></td></tr>
<tr class="separator:affb0c199aa42b451aa5bde772189d5c4"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab543f5625ff3a9736e1aebb3dc8e842a"><td class="memItemLeft" align="right" valign="top"><a id="ab543f5625ff3a9736e1aebb3dc8e842a"></a>
std::deque&lt; <a class="el" href="structscin_1_1comp_1_1StageManager_1_1Wait.html">Wait</a> &gt;&#160;</td><td class="memItemRight" valign="bottom"><b>m_waits</b></td></tr>
<tr class="separator:ab543f5625ff3a9736e1aebb3dc8e842a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a02c0f43a2d346ef6063a06c706fe1037"><td class="memItemLeft" align="right" valign="top"><a id="a02c0f43a2d346ef6063a06c706fe1037"></a>
std::thread&#160;</td><td class="memItemRight" valign="bottom"><b>m_callbackThread</b></td></tr>
<tr class="separator:a02c0f43a2d346ef6063a06c706fe1037"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a63c91776940be8826d96c1522bafa0cd"><td class="memItemLeft" align="right" valign="top"><a id="a63c91776940be8826d96c1522bafa0cd"></a>
std::atomic&lt; bool &gt;&#160;</td><td class="memItemRight" valign="bottom"><b>m_quit</b></td></tr>
<tr class="separator:a63c91776940be8826d96c1522bafa0cd"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>On Discrete GPU devices at least, if not other classes of devices, copying data from host-accessible buffers to GPU-only accessible memory may result in a performance improvement. As Scinths, ScinthDefs, and the general <a class="el" href="classscin_1_1comp_1_1Compositor.html">Compositor</a> may all want to do this, the <a class="el" href="classscin_1_1comp_1_1StageManager.html">StageManager</a> centralizes management of those staging requests so they can be batched and processed all at once.</p>
<p>It also provides a fence for all batched staging requests, and a thread that blocks on that fence, to wait to process callbacks until after content has been staged. </p>
</div><h2 class="groupheader">Member Function Documentation</h2>
<a id="ad73aa252c9730e1d8f6ed591a07403cc"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ad73aa252c9730e1d8f6ed591a07403cc">&#9670;&nbsp;</a></span>setStagingRequested()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void scin::comp::StageManager::setStagingRequested </td>
          <td>(</td>
          <td class="paramtype">std::function&lt; void()&gt;&#160;</td>
          <td class="paramname"><em>requestFunction</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p><a class="el" href="classscin_1_1comp_1_1StageManager.html">StageManager</a> will call the provided function each time there are items to be staged by the main submission thread. </p>

</div>
</div>
<a id="a900f1f9de271ef4ff30b9071a81392b9"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a900f1f9de271ef4ff30b9071a81392b9">&#9670;&nbsp;</a></span>stageImage()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool scin::comp::StageManager::stageImage </td>
          <td>(</td>
          <td class="paramtype">std::shared_ptr&lt; <a class="el" href="classscin_1_1vk_1_1HostBuffer.html">vk::HostBuffer</a> &gt;&#160;</td>
          <td class="paramname"><em>hostBuffer</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">std::shared_ptr&lt; <a class="el" href="classscin_1_1vk_1_1DeviceImage.html">vk::DeviceImage</a> &gt;&#160;</td>
          <td class="paramname"><em>deviceImage</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">std::function&lt; void()&gt;&#160;</td>
          <td class="paramname"><em>completion</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Typically not called on the main render thread, adds the necessary commands to a command buffer to copy the host-accessible image bytes into optimal tiling and layout for read-only sampling. </p>

</div>
</div>
<a id="aa99922762802ea02b4ad818be05e01f3"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aa99922762802ea02b4ad818be05e01f3">&#9670;&nbsp;</a></span>submitTransferCommands()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool scin::comp::StageManager::submitTransferCommands </td>
          <td>(</td>
          <td class="paramtype">VkQueue&#160;</td>
          <td class="paramname"><em>queue</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Since VkFence objects can only be waited on by one thread, we submit the transfer commands separately from the compositor commands. This function must be called on the main submission thread. </p>

</div>
</div>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Wed Apr 15 2020 20:39:13 for Scintillator by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.17
</small></address>
</body>
</html>
